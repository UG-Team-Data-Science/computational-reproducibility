pages:
  stage: deploy
  image: python:3.11
  before_script:
    # Install build dependencies
    - pip install --no-cache-dir sphinx sphinx-revealjs esbonio
    # Install Quarto
    - apt-get update && apt-get install -y --no-install-recommends curl gdebi-core pandoc
    - curl -LO https://github.com/quarto-dev/quarto-cli/releases/download/v1.8.26/quarto-1.8.26-linux-amd64.deb
    - gdebi --non-interactive quarto-1.8.26-linux-amd64.deb
    - rm -f quarto-1.8.26-linux-amd64.deb
  script:
    # Build reveal.js slides in docs/
    # - pip install --no-cache-dir sphinx sphinx-revealjs esbonio
      # - rm -rf public
      # - make -C docs revealjs
    - rm -rf public
    - mkdir -p public
      # Build Quarto slides
     # Build slides (output lives next to the input file)
    - cd docs/quarto
    - quarto render slides.qmd --to revealjs --debug

    # Move the rendered site to the GitLab Pages folder
    - mv slides.html ../../public/index.html
    - mv slides_files ../../public/slides_files 2>/dev/null || true
    - mv slides-revealjs ../../public/slides-revealjs 2>/dev/null || true
    - cd ../../
    - echo "--- PUBLIC DIR CONTENTS ---"
    - ls -R public || echo "no public directory"
    - echo "--- ROOT DIR CONTENTS ---"
    - ls -la
    # - sphinx-build -b revealjs docs/source public/sphinx


  artifacts:
    paths:
      - public
  only:
    - main   # or 'master', depending on your default branch
