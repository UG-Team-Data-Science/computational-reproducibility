---
project:
  type: website
  output-dir: public/quarto

title: "Reproducible Software"
subtitle: "A Container Approach"
date: "January 2026"
date-format: "MMMM YYYY"
format:
  revealjs:
    logo: images/dcc_logo2.png
    css: slides.css
    theme: simple
    chalkboard: true
    slide-number: true
    transition: fade
    incremental: false
---

## Content

- Using containers for reproducible research
- Working with containers
	- Running
	- Building
	- Stopping and deleting
	- Persistent storage
- Using containers in the cloud

# Introduction

## Goal

Computational reproducibility means that research results obtained through computation can be consistently **re-produced** by others given the same inputs and methods.

## The Pillars

- Code
- Data
- **Environment**
- Documentation
- Workflows

## The Challenges

- Software rot
- Data availability
- Complexity
- Human factors

## Why reproducibility matters {.smaller}

- **Trust:** Verifiable results build confidence in findings.
- **Reuse:** Reproducible workflows let others (and future-you) build on your work.
- **Transparency:** Clear methods reduce errors and enable scrutiny.
- **Efficiency:** Saves time by avoiding duplicated effort.
- **Credit:** Reproducible artifacts (data, code, environments) increase reuse and citations.



- **Open Science:** Share code, data, and methods openly when possible.
- **FAIR:** Make outputs Findable, Accessible, Interoperable, and Reusable.


## Benefits of Computational Reproducibility

1. Integrity and trust
2. **Efficiency and reuse**
3. Collaboration and transparency
4. Long-term preservation
5. Scalability and generalization
6. Policy and funding compliance

## Spectrum of reproducibility

![](/images/reproducible-matrix.jpg){width=800px}

## Tools for Computational Reproducibility

- Version control
- Virtualization
	- **Containerization**
	- Virtual machines
	- Package managers (pip, conda, CRAN, Bioconductor)
- Workflow systems
- Data repositories
- Notebooks and literate programming
- Community standards

## Capturing Computational Environments

![](/images/computational-enviro.png){width=800px}

# Reproducible Research with Containers


## Container Terminology

| Core objects | Supporting services |
| --- | --- |
| - **Images** | - **Volumes** |
| - **Containers** | - **Registries** |
| - **Dockerfile** | - **Docker Hub** |
| - **Ports** | - **Networking** |
| - **etc.** | - **Docker daemon** |

## Installing Docker (macOS, Linux, Windows)

- [Docker Desktop (macOS)](https://docs.docker.com/desktop/setup/install/mac-install/)
- [Docker Desktop (Linux)](https://docs.docker.com/desktop/setup/install/linux/)
- [Docker Desktop (Windows)](https://docs.docker.com/desktop/setup/install/windows-install/)

## Preparing our reproducible workspace

1. Open a terminal

::: {.panel-tabset}
#### Linux (bash)

```bash
# Display the current working directory
pwd
# Create a new folder `shared`
mkdir shared
```

#### PowerShell

```powershell
# Display the current working directory
Get-Location    # or: pwd

# Create a new folder `shared`
New-Item -ItemType Directory -Name shared   # or: mkdir shared
```

#### Windows CMD

```bat
REM Display the current working directory
echo %cd%    REM or: cd

REM Create a new folder `shared`
mkdir shared    REM or: md shared
```
:::

2. Pull the following docker image

    ```bash
    docker pull venustiano/fdvcw:27-12-25
    ```
3. Let the pull finish

## Reproducing the book

<iframe src="https://clauswilke.com/dataviz/" width="100%" height="600px"></iframe>

## Alternatives

:::: {.columns}

::: {.column width="50%"}
- Cloud

  - [![Launch RUG Binder](https://img.shields.io/badge/launch%20-rug%20binder-009CEF?logo=jupyter)](https://binderhub.app.rug.nl/v2/gh/Venustiano/datavizclaus/HEAD)
  - [![Launch MyBinder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/Venustiano/datavizclaus/HEAD?urlpath=lab)
  - GitHub codespaces
  - HPC (Habrok)
:::
::: {.column width="50%"}

- Locally (Window, Linux, MacOS)
  - Pull and run the docker image
  - Build and run the docker image
:::


::::

## The Binder Workflow

![](/images/binder-comic-5aa62b109e2a7023a5abc80b4312ad31.png){width=800px fig-align="center"}

## The BinderHub architecture

![](/images/binderhub-9e26d430c9c40fc4db6f858e376c15a9.svg){width=800px fig-align="center"}

## Running the dataviz environment

- Source code (746 forks and 3.4k stars)
  - [https://github.com/clauswilke/dataviz](https://github.com/clauswilke/dataviz)
  - [https://github.com/Venustiano/datavizclaus](https://github.com/Venustiano/datavizclaus) (forked)
- MyBinder (public)
  - [![Launch MyBinder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/Venustiano/datavizclaus/HEAD?urlpath=rstudio)

- RUG Binder
  - [![Launch RUG Binder](https://img.shields.io/badge/launch%20-rug%20binder-009CEF?logo=jupyter)](https://binderhub.app.rug.nl/v2/gh/Venustiano/datavizclaus/HEAD)

::: aside

Right click on a badge and select `Open link in new tab`.
:::

## {.smaller}
To reproduce this chapter:

<iframe src="https://clauswilke.com/dataviz/histograms-density-plots.html#multiple-histograms-densities" width="100%" height="400px"></iframe>

1. Open `visualizing_distributions_I.Rmd` in Rstudio
2. Click on `Knit`

## Binder Pro's

- Launches Jupyter/R notebooks in the cloud
- No local install needed
- Share reproducible environments
- Great for teaching and demos
- Free
- Easy to start via [https://mybinder.org/](https://mybinder.org/)

## Binder Con's

- Starting the environment can be slow
- Environment is sutdown after 10 minutes inactivity
- Few resources (2 GB in RAM)
- No persistent storage
- Not reliable for big groups

## When is Binder appropriate?

- To share a reproducible environment
- To communicate something in an interactive manner
- When the code and associated data are publicly available
- When the code you want to run does not require a lot of resources

# Containers in more detail

## Container architecture

::: columns
::: column
![](/images/Docker-Website-2018-Diagrams-071918-V5_26_Docker-today-1110x919.png){width=100%}
:::
::: column
![](/images/container-what-is-container-1110x961.png){ width=800px fig-align="center" target="https://www.docker.com/app/uploads/2021/11/container-what-is-container-1110x961.png" }
:::
:::



## Running Containers {data-auto-animate=true}

```bash
docker run hello-world
```

## Running Containers (output) {data-auto-animate=true}

```text
docker run hello-world

Hello from Docker!

 This message shows that your installation appears to be working correctly.

 To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 ...
 4. The Docker daemon streamed that output to the Docker client, which sent it
 to your terminal.
 ...
 For more examples and ideas, visit:
 https://docs.docker.com/get-started/
```

## Containers and Images 

- An `image` is a read-only, versioned filesystem template (layers) with metadata (env defaults) **used to create containers**. 

- A `container` is a running (or stopped) instance of an image: a process with **isolated filesystem**, networking, and resources, **created from an image**.

```bash
docker ps            # List running containers
docker ps -a         # List all containers (including stopped)
docker images        # List all images
```

## The layered filesystem

![](/images/image_layers.png){fig-align="center"}

## The container layer

![](/images/container_layers.png){fig-align="center"}


## Container Lifecycle

![](/images/container_lifecycle.png){width=800px fig-align="center" target="https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fgevspybo00m3a7l4hfrz.png"}

## Having fun with Containers

```bash
docker run -it debian bash                # Start an interactive bash session
apt update                                # Update package lists
apt install -y cowsay fortune             # Install cowsay and fortune
/usr/games/fortune | /usr/games/cowsay    # Enjoy!
```
<br>

```
/ Living your life is a task so          \
| difficult, it has never been attempted |
\ before.                                /
 ----------------------------------------
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||

```
<br>

```bash
exit                                      # Stop/exit the container
```

## Start the `FDV` container

- Run the container

  ```bash
  docker run -it -p 8888:8888 venustiano/fdvcw:27-12-25
  ```
- Inspect your Docker Environment

  - Open a second terminal and run:

    ```bash
    docker ps            # List running containers
    docker ps -a         # List all containers (including stopped)
    docker images        # List all images
    ```

## Accessing `JupyterLab`

1. Open the link similar to

    ```bash
    http://127.0.0.1:8888/lab?token=d4ac9278f5f5388e88097a3a8ebbe9401be206cfa0b83099
    ```
2. Open `RStudio` and knit some of the `.Rmd` files.

3. Optional, open the `selectedfigures/temp-ridgeline_5.4.R` and run the script in `Rstudio`.

::: {.callout .callout-warning}
**Warning:** `Changes made inside the container layer are ephemeral` — they will be lost when the container is rebuilt or restarted. 
:::

## `host:container` port mapping

```bash
docker run -it -p 8888:8888 venustiano/fdvcw:27-12-25
```

![](/images/portmapping.drawio.png){height=60% fig-align="center" target="https://k21academy.com/wp-content/uploads/2020/11/portmapping.drawio.png"}

## Stopping Containers

- Via `JupyterLab`, `Menu`-> `File` -> `Shut Down`

- Via the command line:

  ```bash
  docker ps                     # List running containers
  docker stop <container_id>    # Stop a running container
  docker stop <container_name>  # Stop a running container
  docker ps                     # Verify the container has stopped
  ```

## Restarting or removing a container

```bash
# list containers
docker ps --all
# CONTAINER ID   IMAGE                                       COMMAND                  CREATED              STATUS                     PORTS     NAMES
# eca4aa01751c   quay.io/jupyter/scipy-notebook:2025-03-14   "tini -g -- start-no…"   About a minute ago   Exited (0) 5 seconds ago             silly_panini

# start the stopped container
docker start --attach -i eca4aa01751c
# Entered start.sh with args: jupyter lab
# ...

# remove the stopped container
docker rm eca4aa01751c
# eca4aa01751c
```

## Removing Containers and Images

```bash
docker ps -a                  # List all containers
docker rm <container_id>      # Remove a stopped container by ID
docker rm <container_name>    # Remove a stopped container by name
docker images                 # List all images
docker rmi <image_id>         # Remove an image by ID
docker rmi <image_name>       # Remove an image by name
```

- Remove all the `fdvcw` containers

# Volumes

## Persistent storage (volumes)

![](/images/docker-storage.png){width=500px fig-align="center" target="https://iamachs.com/images/posts/docker/part-5-understanding-docker-storage-and-volumes/docker-storage.png"}

## What are Bind Mounts? {.smaller}

![](/images/ChatGPT_Image_Oct_27_2025_10_37_27_PM.png){width=600px, fig-align="center"}

*Image credit: OpenAI ChatGPT*


- Bind mounts map a file or directory from the host into a container.
- Changes on the host are reflected in the container and vice versa.

## Host vs. Container filesystems

:::: {.columns}
::: {.column width="40%"}
Host
![](/images/HostFileSystem.png){width="400px" fig-align="center"}
:::

:::{.column width="60%"}
Container
![](/images/ContainerFilesystem.png){width="600px" fig-align="center"}
:::
::::

## How to use Bind Mounts

::: {.panel-tabset}
#### Linux (bash)

```bash
docker run -it -p 8888:8888 \
  -v "$PWD":/home/jovyan/bind_folder \    # <1>
  venustiano/fdvcw:27-12-25
```
1. Specify a host path and a container path.

#### PowerShell

```powershell
docker run -it -p 8888:8888 `
  -v "${PWD}:/home/jovyan/bind_folder" `    # <1>
  venustiano/fdvcw:27-12-25
```
1. Specify a host path and a container path.

#### Windows CMD

```bat
docker run -it -p 8888:8888 ^
  -v "%cd%:/home/jovyan/bind_folder" ^      #<1>
  venustiano/fdvcw:27-12-25
```

1. Specify a host path and a container path.

:::


- Docker mounts the host path into the container path at runtime.
- Changes on the host are reflected in the container and vice versa.

## Store 100 numpy exercises

1. Once in JupyterLab, open a terminal and run:

```bash
cd bind_folder
git clone https://github.com/rougier/numpy-100.git
pip install mdutils
```

2. Double-click on `100_numpy_exercises.ipynb` to open the notebook.
3. Have some fun!
4. In the menu, click on `File` then on `Shut Down` to stop the server.

# Docker Images

## Creating images {.smaller}

:::: columns
::: column
### Interactive
- `Fast for exploration and debugging`
- Low setup overhead — `good for one-off tests`
- Can be useful when iterating quickly
- **Con:** changes live in the container layer and are ephemeral
- **Con:** steps are easy to forget, which hurts reproducibility
:::
::: column
### Dockerfile (declarative)
- Reproducible and versionable 
- Automatable and CI/CD friendly
- Easier to review and share with collaborators
- **Con:** `higher upfront effort and learning curve`
- **Con:** `you must rebuild the image to apply changes`
:::
::::

## Building an image from a container

```bash
# Commit a container (running or stopped) to a new image
docker commit <CONTAINER_ID_or_NAME> myimage:latest
```
<br>
Example:
```bash
# Display ID and Name
docker ps -a
# Create the image, replace the text between <> 
docker commit <CONTAINER_ID_or_NAME> myfdvimage:mdutils
```

## Building an image using a Dockerfile

1. Create a `cowsay` folder
2. In that folder, create a `Dockerfile` file with the following content

    ```bash
    FROM debian
    RUN apt-get update && apt-get install -y cowsay fortune
    ```
3. Build the image running

    ```bash
    docker build -t test/cowsay .
    ```

::: aside
Make sure you are in the `cowsay` folder before running the command
:::

## A `Dockerfile` for our environment {.smaller}

```bash
# Purpose: extend venustiano/fdvcw:27-12-25 and install the `mdutils` Python package.

FROM venustiano/fdvcw:27-12-25                    # <1>
RUN pip install --no-cache-dir mdutils && \       # <2>
    fix-permissions "${CONDA_DIR}" && \           # <3>
    fix-permissions "/home/${NB_USER}"            # <4>


```

1. Sets the base image
2. System-wide pip installation, `--no-cache-dir` tells pip not to keep wheel/cache files
3. Ensures the non-root notebook user can use Conda
4. Ensures files created during the image build are writable by the `NB_USER` (notebook user) at runtime

::: aside
Create the `Dockerfile` and folder to build the image

::: {.panel-tabset}
#### Linux/Windows

```bash
docker build -t fdvcw:20-01-2026 .
```

#### macOS (arm)

```bash
docker build --platform linux/amd64 -t fdvcw:20-01-2026 .
```
:::

:::

## Using a `requirements.txt` file {.smaller}

```bash
FROM venustiano/fdvcw:27-12-25                    

# Install from the requirements.txt file
COPY --chown=${NB_UID}:${NB_GID} requirements.txt /tmp/     #<1>
RUN pip install --no-cache-dir --requirement /tmp/requirements.txt && \
    fix-permissions "${CONDA_DIR}" && \
    fix-permissions "/home/${NB_USER}"


```

1. Copies the host file requirements.txt into the image at `/tmp/requirements.txt`

<br>

- `--chown=${NB_UID}:${NB_GID}`: sets the owner and group of the copied file inside the image to the values of `NB_UID` and `NB_GID`.
- `UID`: numeric user identifier used by the OS to represent a user (e.g., 0 = root).
- `GID`: numeric group identifier used by the OS to represent a group.

Create the `Dockerfile` and `requirements.txt` to build an image, see next slide.

## Building an image from a `Dockerfile`

```bash
# Build using Dockerfile in current directory (DO NOT RUN)
docker build -t myimage:latest .

# Specify Dockerfile path and context
docker build -f ./path/to/Dockerfile -t myrepo/myimage:1.0 ./path/to/context
```

- `-f`: specify the Dockerfile path to use. 
- `-t`: tag the built image (`name[:tag]`).
- `context`: the directory sent to the builder (last argument), — Docker sends the entire context to the daemon, so `keep it minimal`.

## Build the image

```bash
# 1. Make sure you have created the Dockerfile and requeriments.txt files
ls -l

# 2. Run the command
# on arm architecture
# docker build --platform linux/amd64 -t fdvcw:20-01-2026 .
docker build -t fdvcw:19-01-2026 .

# 3. Wait and list the images
docker images

# 4. Run the container (optional)
docker run -it -p 10000:8888 venustiano/fdvcw:19-01-2026    #<4>

# 5. Access JupyterLab, make sure you use port 10000 in the url
```

4. `-p 10000:8888`: Makes sure the port is mapped to the port `10000` in case `8888` is already in use.

## Removing the container automatically
```bash
docker run --rm -it -p 8888:8888 \                  # <1>
  -v $(pwd):/home/jovyan/bind_folder venustiano/fdvcw:19-01-2026
```
1. The `--rm` flag removes the container when the container is shutdown.

## Dockerfile (common keywords) {.smaller}

```bash
FROM python:2.7
RUN mkdir -p /app
WORKDIR /app
COPY ./requirements.txt /app/
RUN pip install -r requirements.txt
CMD ["python", "main.py"]
```
<br>

| Instruction | Description |
| --- | --- |
| `FROM` | Create a new build stage from a base image. |
| `RUN`| Execute build commands. |
| `WORKDIR`  | Change working directory. |
| `COPY`  | Copy files and directories. |
| `CMD` | Specify default commands when container starts |

:::aside
[Dockerfile reference](https://docs.docker.com/reference/dockerfile/)
:::

## Dockerfile vs layers

![](/images/dockerfile_layers.png){width="600px" fig-align="center"}


# Container registries

## Understanding the container registry

![](/images/Docker-hub-registry-768.webp){width=800px fig-align="center" target="https://media.geeksforgeeks.org/wp-content/uploads/20240513153832/Docker-hub-registry-768.webp"}

## Public Container Registries {.smaller}

- [Docker Hub](https://hub.docker.com) — central public registry for container images.
- [Quay.io](https://quay.io) — Red Hat's container registry and image security features.
- [GitHub Container Registry (ghcr.io)](https://ghcr.io) — GitHub's registry for container images.
- [Google Artifact Registry / Container Registry](https://cloud.google.com/container-registry) — Google's container registries.
- [Amazon ECR Public](https://public.ecr.aws) — AWS public container registry.
- [Microsoft Container Registry (MCR)](https://mcr.microsoft.com) — Microsoft-hosted container images.


## Registry

- Docker Hub web interface: [https://hub.docker.com/search?q=jupyter](https://hub.docker.com/search?q=jupyter)
- Best practices:
	- Prefer official images
	- Verify trusted publishers
	- Always use specific tags
	- Avoid `latest` tag for reproducibility

## Ready to use environments

:::: {.columns style="font-size: 0.8em;"}
::: {.column width="50%"}
[Jupyter stacks](https://jupyter-docker-stacks.readthedocs.io/en/latest/)

![](/images/jupyter-logo.svg){height="200px" fig-align="center" target="https://jupyter-docker-stacks.readthedocs.io/en/latest/_static/jupyter-logo.svg"}

| image | pulls  |
|-------|--------|
| [`scipy-notebook`](https://hub.docker.com/r/scipy-notebook)  | ![Docker Pulls](https://img.shields.io/docker/pulls/jupyter/scipy-notebook)     |
| [`datascience-notebook`](https://hub.docker.com/r/jupyter/datascience-notebook)  | ![Docker Pulls](https://img.shields.io/docker/pulls/jupyter/datascience-notebook)     |


:::

:::{.column width="50%" }
[Rocker](https://rocker-project.org/)

![](/images/rocker.png){height="200px" fig-align="center" target="https://rocker-project.org/img/rocker.png"}

| image | pulls  |
|-------|--------|
| [`rstudio`](versioned/rstudio.md)  | ![Docker Pulls](https://img.shields.io/docker/pulls/rocker/rstudio)     |
| [`tidyverse`](versioned/rstudio.md)  |  ![Docker Pulls](https://img.shields.io/docker/pulls/rocker/tidyverse)   |
:::
::::

## Dependency tree of the stack images


![](/images/inherit.svg){width=1200px fig-align="center" target="https://raw.githubusercontent.com/jupyter/docker-stacks/refs/heads/main/docs/images/inherit.svg"}

## [Running a container](https://jupyter-docker-stacks.readthedocs.io/en/latest/using/running.html)

```bash
docker run -it -p 8888:8888 quay.io/jupyter/scipy-notebook:2025-03-14
# Entered start.sh with args: jupyter lab
# ...
#     To access the server, open this file in a browser:
#         file:///home/jovyan/.local/share/jupyter/runtime/jpserver-7-open.html
#     Or copy and paste one of these URLs:
#         http://eca4aa01751c:8888/lab?token=d4ac9278f5f5388e88097a3a8ebbe9401be206cfa0b83099
#         http://127.0.0.1:8888/lab?token=d4ac9278f5f5388e88097a3a8ebbe9401be206cfa0b83099
```


## Understanding the command

```bash
docker run -it -p 8888:8888 quay.io/jupyter/scipy-notebook:2025-03-14
|       |   |   |               |         |                    |
|       |   |   |               |         |                    +-- Version tag
|       |   |   |               |         +-- Image name from Jupyter
|       |   |   |               +-- Registry (Quay.io)
|       |   |   +-- Port mapping (host:container)
|       |   +-- Interactive terminal
|       +-- Run a container
+-- Docker command
```



## Publish docker images

1. Build the image
2. Tag the image
  ```bash
  docker image tag my-username/my-image:tag another-username/another-image:v1
  ```
3. Log in, if needed [Create an account](https://app.docker.com/signup)
  ```bash
  docker login -u <my-username>
  ```
4. Push the image
  ```bash
  docker push my-username/my-image
  ```

::: aside
[Build, tag and publish an image](https://docs.docker.com/get-started/docker-concepts/building-images/build-tag-and-publish-an-image/)
:::

# Running containers in the cloud

## Binder

The [RUG Binder](https://jupyterhub.app.rug.nl) features

- 2FA
- 5GB of persisten storage
- 3 simultaneous instances (running containers)
- 2 GB in RAM
- Must delete stopped containers

::: aside

The badge below opens the FDV environment on the RUG Binder platform:

- [![Launch RUG Binder](https://img.shields.io/badge/launch%20-rug%20binder-009CEF?logo=jupyter)](https://binderhub.app.rug.nl/v2/gh/Venustiano/datavizclaus/HEAD)
:::

## GitHub codespaces {.smaller}


- Cloud-based development environments
- Run VS Code and JupyterLab in your browser
- Pre-configured for your project
- No local setup needed
- Code, build, and test from anywhere
- Great for collaboration and reproducibility

::: aside
Resources

- [Quickstart for GitHub Codespaces](https://docs.github.com/en/codespaces/quickstart)
- [Deep dive into GitHub Codespaces](https://docs.github.com/en/codespaces/about-codespaces/deep-dive)
- [Introduction to GitHub Codespaces](https://www.datacamp.com/tutorial/github-codespaces)
:::



## Running FDV in codespaces

![](/images/configuration-as-code.webp){width=800px fig-align="center"}

[https://github.com/Venustiano/datavizclaus/tree/fdvcwcontainer](https://github.com/Venustiano/datavizclaus/tree/fdvcwcontainer)

## GitHub Benefits

- [GitHub Student Developer Pack](https://education.github.com/pack)
- [Students - GitHub Education](https://github.com/education/students)
- [Teachers - GitHub Education](https://github.com/education/teachers)


# Containers in HPC (advanced)

## Apptainers

- Basic architecture of `Habrok`
- Convert Docker containers into Apptainer containers
- Request resources, RAM, Nodes, GPUs
- Run jobs
- Port forwarding


